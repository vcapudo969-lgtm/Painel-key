<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Key System PRO</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:Arial;background:#020617;color:#fff}
.box{max-width:420px;margin:80px auto;background:#020617;border:1px solid #1e293b;padding:20px;border-radius:10px}
input,select,button{
  width:100%;padding:10px;margin-top:10px;
  background:#020617;color:#fff;border:1px solid #334155;border-radius:6px
}
button{background:#2563eb;border:none;font-weight:bold}
button.red{background:#dc2626}
button.gray{background:#475569}
.hidden{display:none}
.menu{background:#020617;padding:10px;border-bottom:1px solid #1e293b}
.card{background:#020617;border:1px solid #1e293b;padding:10px;margin-top:10px;border-radius:6px}
.small{font-size:13px;color:#cbd5f5}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginBox" class="box">
<h2>Login / Registro</h2>
<input id="loginUser" placeholder="Usu√°rio">
<input id="loginPass" type="password" placeholder="Senha">
<button onclick="login()">Entrar</button>
<button onclick="register()" class="gray">Registrar</button>
<p id="msg" style="color:red"></p>
</div>

<!-- APP -->
<div id="app" class="hidden">
  <div class="menu">
    <button onclick="toggleMenu()">‚ò∞</button>
    <span id="userInfo"></span>
    <button onclick="logout()" class="red">Sair</button>
  </div>
  <div id="menuBox" class="hidden"></div>
  <div id="content" class="box"></div>
</div>

<script>
/* ===== PLANOS ===== */
const PLANS={
  "24h":{h:24,c:1},
  "3d":{h:72,c:5},
  "5d":{h:120,c:10},
  "15d":{h:360,c:20},
  "30d":{h:720,c:30}
}

/* ===== DADOS ===== */
let users=JSON.parse(localStorage.getItem('users')||'{}')
let keys=JSON.parse(localStorage.getItem('keys')||'[]')

users.admin={pass:'admin123',role:'admin',credits:Infinity,banned:false,prefix:'KEY'}
localStorage.setItem('users',JSON.stringify(users))

let currentUser=sessionStorage.getItem('user')
let role=sessionStorage.getItem('role')

/* ===== LOGIN ===== */
function login(){
  const u=loginUser.value.trim()
  const p=loginPass.value.trim()
  if(!users[u]||users[u].pass!==p||users[u].banned){
    msg.innerText='Login inv√°lido';return
  }
  sessionStorage.setItem('user',u)
  sessionStorage.setItem('role',users[u].role)
  location.reload()
}

function register(){
  const u=prompt('Usu√°rio:')
  const p=prompt('Senha:')
  if(!u||!p||users[u])return alert('Inv√°lido')
  users[u]={pass:p,role:'user',credits:5,banned:false,prefix:'KEY'}
  save();alert('Registrado com 5 cr√©ditos')
}

/* ===== MENU ===== */
function toggleMenu(){
  menuBox.innerHTML=''
  menuBox.classList.toggle('hidden')

  if(role==='admin'){
    menuBox.innerHTML+=btn('Gerenciar Usu√°rios','usersPanel()')
    menuBox.innerHTML+=btn('Gerenciar Keys','keysPanel()')
  }else{
    menuBox.innerHTML+=btn('Personalizar Key','customPanel()')
    menuBox.innerHTML+=btn('Gerar Key','genPanel()')
    menuBox.innerHTML+=btn('Minhas Keys','myKeys()')
  }
}

function btn(t,f){return `<button onclick="${f}" class="gray">${t}</button>`}

/* ===== PERSONALIZAR ===== */
function customPanel(){
  content.innerHTML=`
  <h3>Personalizar Key</h3>
  <input id="newPrefix" placeholder="Prefixo da Key" value="${users[currentUser].prefix}">
  <button onclick="savePrefix()">Salvar</button>`
}
function savePrefix(){
  users[currentUser].prefix=newPrefix.value||'KEY'
  save();alert('Prefixo salvo')
}

/* ===== GERAR ===== */
function genPanel(){
  content.innerHTML=`
  <h3>Gerar Key</h3>
  <select id="plan">
    <option value="24h">24h (1)</option>
    <option value="3d">3 dias (5)</option>
    <option value="5d">5 dias (10)</option>
    <option value="15d">15 dias (20)</option>
    <option value="30d">30 dias (30)</option>
  </select>
  <button onclick="generate()">Gerar</button>`
}

function generate(){
  const p=PLANS[plan.value]
  if(users[currentUser].credits<p.c)return alert('Sem cr√©ditos')
  const k=users[currentUser].prefix+'-'+crypto.randomUUID().slice(0,10).toUpperCase()
  keys.push({
    key:k,
    owner:currentUser,
    expires:Date.now()+p.h*3600000,
    paused:false,
    remaining:p.h*3600000
  })
  users[currentUser].credits-=p.c
  save();alert('Key criada')
}

/* ===== KEYS USU√ÅRIO ===== */
function myKeys(){
  content.innerHTML='<h3>Minhas Keys</h3>'
  keys.filter(k=>k.owner===currentUser).forEach(k=>{
    content.innerHTML+=`
    <div class="card">
      ${k.key}
      <div class="small">${countdown(k)}</div>
      <button onclick="togglePause(k)">‚è∏ Pausar</button>
      <button onclick="resetKey(k)">üîÑ Reset</button>
    </div>`
  })
}

function togglePause(k){
  k.paused=!k.paused
  if(k.paused) k.remaining=k.expires-Date.now()
  else k.expires=Date.now()+k.remaining
  save();myKeys()
}

function resetKey(k){
  k.expires=Date.now()+k.remaining
  save();myKeys()
}

/* ===== ADMIN ===== */
function usersPanel(){
  content.innerHTML='<h3>Usu√°rios</h3>'
  Object.keys(users).forEach(u=>{
    if(u==='admin')return
    content.innerHTML+=`
    <div class="card">
      ${u} | Cr√©ditos: ${users[u].credits}
      <button onclick="users['${u}'].credits+=10;save();usersPanel()">+10</button>
      <button onclick="users['${u}'].banned=true;save();usersPanel()" class="red">Banir</button>
    </div>`
  })
}

function keysPanel(){
  content.innerHTML='<h3>Todas as Keys</h3>'
  keys.forEach(k=>{
    content.innerHTML+=`
    <div class="card">
      ${k.key} (${k.owner})
      <div class="small">${countdown(k)}</div>
    </div>`
  })
}

/* ===== UTIL ===== */
function countdown(k){
  if(k.paused)return '‚è∏ Pausada'
  let t=k.expires-Date.now()
  if(t<=0)return '‚åõ Expirada'
  let d=Math.floor(t/86400000)
  let h=Math.floor(t%86400000/3600000)
  let m=Math.floor(t%3600000/60000)
  let s=Math.floor(t%60000/1000)
  return `‚è≥ ${d}d ${h}h ${m}m ${s}s`
}

function save(){
  localStorage.setItem('users',JSON.stringify(users))
  localStorage.setItem('keys',JSON.stringify(keys))
}

function logout(){
  sessionStorage.clear();location.reload()
}

/* ===== START ===== */
if(currentUser){
  loginBox.classList.add('hidden')
  app.classList.remove('hidden')
  userInfo.innerText=
    currentUser+' | Cr√©ditos: '+(users[currentUser].credits===Infinity?'‚àû':users[currentUser].credits)
  setInterval(()=>{ if(content.innerHTML.includes('Minhas Keys')) myKeys() },1000)
}
</script>

</body>
</html>
