<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KeyGen Pro v14 | Menu Sanduíche Integrado</title>
    <script src="unpkg.com"></script>
    <link href="fonts.googleapis.com" rel="stylesheet">
    <style>
        :root {
            --bg: #000000; --card: #1a1a1a; --border: #333333;
            --primary: #e62e2e; --secondary: #4ade80; --danger: #ef4444;
            --warning: #f59e0b; --text: #f9fafb; --dim: #a0a0a0;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
        body { background: var(--bg); color: var(--text); min-height: 100vh; }
        
        /* --- AUTH SYSTEM --- */
        #auth-screen { position: fixed; inset: 0; background: var(--bg); z-index: 2000; display: flex; align-items: center; justify-content: center; }
        .auth-card { background: var(--card); width: 90%; max-width: 400px; padding: 2rem; border-radius: 12px; border: 1px solid var(--border); }
        .auth-tabs { display: flex; background: #000; padding: 5px; border-radius: 8px; margin-bottom: 1.5rem; border: 1px solid var(--border); }
        .tab-btn { flex: 1; padding: 10px; border: none; background: none; color: var(--dim); cursor: pointer; font-weight: 700; border-radius: 6px; }
        .tab-btn.active { background: var(--border); color: white; }

        /* --- UI ELEMENTS --- */
        .field { margin-bottom: 1.2rem; }
        label { display: block; font-size: 0.75rem; color: var(--dim); margin-bottom: 8px; font-weight: 800; text-transform: uppercase; }
        input, select { width: 100%; padding: 14px; background: #000; border: 1px solid var(--border); border-radius: 6px; color: white; outline: none; }
        input:focus { border-color: var(--primary); }
        .btn { width: 100%; padding: 14px; border-radius: 6px; border: none; font-weight: 800; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-secondary { background: var(--secondary); color: white; }

        /* --- APP STRUCTURE --- */
        #main-app { display: none; }
        header { padding: 1.5rem 2rem; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); z-index: 100; }
        .brand { font-weight: 800; color: var(--primary); }
        .badge { padding: 5px 12px; border-radius: 100px; font-size: 0.7rem; font-weight: 800; border: 1px solid; }

        main { padding: 2rem; max-width: 900px; margin: 0 auto; padding-bottom: 100px; }
        .view { display: none; }
        .view.active { display: block; animation: fadeIn 0.4s ease; }
        .card { background: var(--card); padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border); margin-bottom: 1.5rem; }

        /* --- TABLES --- */
        .table-container { overflow-x: auto; border-radius: 8px; border: 1px solid var(--border); background: var(--card); }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px 16px; text-align: left; border-bottom: 1px solid var(--border); font-size: 0.85rem; }
        th { background: var(--bg); color: var(--dim); font-size: 0.7rem; text-transform: uppercase; }
        .status-pill { padding: 3px 8px; border-radius: 4px; font-size: 0.65rem; font-weight: bold; }
        .active-pill { color: var(--secondary); }
        .paused-pill { color: var(--warning); }
        .expired-pill { color: var(--danger); }
        .key-mono { font-family: 'JetBrains Mono', monospace; }

        /* --- MENU SANDUÍCHE (FAB) --- */
        .menu-wrapper { position: fixed; bottom: 30px; right: 30px; z-index: 1001; }
        #fab { width: 60px; height: 60px; border-radius: 50%; background: var(--primary); display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 10px 20px rgba(0,0,0,0.4); }
        .drawer { position: absolute; bottom: 75px; right: 0; width: 250px; background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 10px; display: none; box-shadow: 0 15px 30px rgba(0,0,0,0.6); }
        .drawer.open { display: block; animation: fadeIn 0.3s ease; }
        .nav-link { padding: 12px; display: flex; align-items: center; gap: 10px; cursor: pointer; color: var(--dim); border-radius: 4px; transition: 0.2s; }
        .nav-link:hover { background: var(--border); color: white; }
        .nav-link.active-link { color: var(--primary); font-weight: bold; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <!-- AUTH SCREEN -->
    <div id="auth-screen">
        <div class="auth-card">
            <div class="auth-tabs">
                <button class="tab-btn active" id="tab-member" onclick="toggleAuth('member')">MEMBRO</button>
                <button class="tab-btn" id="tab-admin" onclick="toggleAuth('admin')">ADMIN</button>
            </div>
            <div id="auth-member">
                <div class="field">
                    <label>Nome do Usuário</label>
                    <input type="text" id="reg-name" placeholder="Ex: Revenda_Pro">
                </div>
                <button class="btn btn-secondary" onclick="registerUser()">ENTRAR COMO MEMBRO</button>
            </div>
            <div id="auth-admin" style="display:none">
                <div class="field">
                    <label>Chave Mestra ADM</label>
                    <input type="password" id="master-key" placeholder="••••••••">
                </div>
                <button class="btn btn-primary" onclick="loginAdmin()">ENTRAR COMO ADM</button>
            </div>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="main-app">
        <header>
            <div class="brand">4m Cheats</div>
            <div id="user-role" class="badge">MEMBRO</div>
        </header>

        <main>
            <!-- DASHBOARD -->
            <div id="v-dash" class="view active">
                <h1 style="margin-bottom: 20px;">Dashboard</h1>
                <div class="card">
                    <p style="color:var(--dim); font-size: 0.8rem;">Saldo Disponível</p>
                    <h2 id="display-credits" style="color:var(--secondary); font-size: 2rem;">R$ 0,00</h2>
                    <p style="color:var(--dim); font-size: 0.7rem; margin-top:5px;">Preço por key: R$ 5,00</p>
                </div>
                <div class="card">
                    <p style="color:var(--dim); font-size: 0.8rem;">Total de Keys Ativas</p>
                    <h2 id="display-keys" style="font-size: 2rem;">0</h2>
                </div>
            </div>

            <!-- PERSONALIZAR KEY -->
            <div id="v-gen" class="view">
                <h2>Gerar Nova Licença</h2>
                <div class="card">
                    <label>Prefixo</label>
                    <input type="text" id="k-prefix" placeholder="Ex: VIP-">
                    <label>Duração</label>
                    <select id="k-time">
                        <option value="1">24 Horas (R$ 5,00)</option>
                        <option value="7">7 Dias (R$ 15,00)</option>
                        <option value="30">30 Dias (R$ 40,00)</option>
                    </select>
                    <button id="gen-btn" class="btn btn-secondary" onclick="executeGeneration()">GERAR KEY</button>
                    <div id="k-res-box" style="display:none; margin-top:15px; background:#000; padding:15px; border-radius:6px; border:1px dashed var(--dim); text-align:center;">
                        <p style="font-size: 0.7rem; color:var(--dim); margin-bottom:5px;">KEY GERADA:</p>
                        <code id="k-final" class="key-mono" style="color:var(--primary);"></code>
                    </div>
                </div>
            </div>

            <!-- GERENCIAR KEYS -->
            <div id="v-list" class="view">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                    <h2>Gerenciar Licenças</h2>
                    <button id="adm-freeze-btn" class="btn btn-primary" style="display:none; padding:8px 12px; width:auto; font-size:0.7rem;" onclick="toggleFreeze()">CONGELAR TEMPO</button>
                </div>
                <div class="table-container">
                    <table>
                        <thead><tr><th>KEY</th><th>STATUS</th><th>RESTANTE</th><th>PROPRIETÁRIO</th></tr></thead>
                        <tbody id="table-keys"></tbody>
                    </table>
                </div>
            </div>

            <!-- GERENCIAR USUÁRIOS (ADM) -->
            <div id="v-users" class="view">
                <h2 style="color:var(--primary)">Gestão de Membros</h2>
                <div class="card">
                    <label>Injetar Créditos</label>
                    <select id="adm-user-select"></select>
                    <input type="number" id="adm-amount" placeholder="Valor R$">
                    <button class="btn btn-primary" onclick="injectCredits()">INJETAR SALDO</button>
                </div>
                <div class="table-container">
                    <table>
                        <thead><tr><th>NOME</th><th>SALDO</th><th>AÇÕES</th></tr></thead>
                        <tbody id="table-users"></tbody>
                    </table>
                </div>
            </div>
        </main>

        <!-- MENU SANDUÍCHE (FAB) -->
        <div class="menu-wrapper">
            <div class="drawer" id="menu-drawer">
                <!-- Nav Links here -->
                <div class="nav-link" onclick="nav('dash', this)"><i data-lucide="layout" size="18"></i> Dashboard</div>
                <div class="nav-link" onclick="nav('gen', this)"><i data-lucide="key" size="18"></i> Gerar Keys</div>
                <div class="nav-link" onclick="nav('list', this)"><i data-lucide="list" size="18"></i> Gerenciar Keys</div>

                <div id="adm-nav" style="display:none; border-top: 1px solid var(--border); margin-top:10px; padding-top:10px;">
                    <div class="nav-link" onclick="nav('users', this)" style="color:var(--primary)"><i data-lucide="users" size="18"></i> Gerenciar Usuários</div>
                    <div class="nav-link" onclick="nav('users', this)" style="color:var(--primary)"><i data-lucide="credit-card" size="18"></i> Add Créditos</div>
                </div>

                <div class="nav-link" onclick="location.reload()" style="color:var(--danger); margin-top:10px;"><i data-lucide="log-out" size="18"></i> Sair</div>
            </div>
            <div id="fab" onclick="toggleDrawer()"><i data-lucide="menu" id="fab-icon" style="color:white"></i></div>
        </div>
    </div>

    <script>
        const MASTER_PASS = "ADMIN2025";
        let session = null;
        let clockInterval;

        const getDB = () => JSON.parse(localStorage.getItem('keygen_v14_data')) || { users: [], keys: [], frozen: false, freezeTime: null };
        const saveDB = (db) => localStorage.setItem('keygen_v14_data', JSON.stringify(db));

        function toggleAuth(type) {
            document.getElementById('auth-member').style.display = (type === 'member' ? 'block' : 'none');
            document.getElementById('auth-admin').style.display = (type === 'admin' ? 'block' : 'none');
            document.getElementById('tab-member').classList.toggle('active', type === 'member');
            document.getElementById('tab-admin').classList.toggle('active', type === 'admin');
        }

        function registerUser() {
            const name = document.getElementById('reg-name').value;
            if(!name) return alert("Digite um nome!");
            const db = getDB();
            const user = { id: Date.now(), name, credits: 0, role: 'USER' };
            db.users.push(user);
            saveDB(db);
            startSession(user);
        }

        function loginAdmin() {
            if(document.getElementById('master-key').value === MASTER_PASS) {
                startSession({ name: "Admin Master", role: 'ADM', credits: 999999 });
            } else {
                alert("Senha Incorreta!");
            }
        }

        function startSession(user) {
            session = user;
            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('main-app').style.display = 'block';
            
            if(user.role === 'ADM') {
                document.getElementById('user-role').innerText = "ADMIN MASTER";
                document.getElementById('user-role').style.color = document.getElementById('user-role').style.borderColor = "var(--primary)";
                document.getElementById('adm-nav').style.display = "block";
                document.getElementById('adm-freeze-btn').style.display = "block";
                document.getElementById('gen-btn').className = "btn btn-primary";
                document.getElementById('fab').style.background = "var(--primary)";
                refreshAdmLists();
            } else {
                document.getElementById('user-role').innerText = "MEMBRO VIP";
                document.getElementById('user-role').style.color = document.getElementById('user-role').style.borderColor = "var(--secondary)";
                document.getElementById('fab').style.background = "var(--secondary)";
            }

            if(clockInterval) clearInterval(clockInterval);
            clockInterval = setInterval(updateAllClocks, 1000);
            updateDashboard();
            updateAllClocks();
            lucide.createIcons();
        }

        function updateDashboard() {
            const db = getDB();
            if(session.role !== 'ADM') {
                const me = db.users.find(u => u.id === session.id);
                document.getElementById('display-credits').innerText = `R$ ${me.credits.toFixed(2)}`;
                document.getElementById('display-keys').innerText = db.keys.filter(k => k.ownerId === session.id).length;
            } else {
                document.getElementById('display-credits').innerText = "INFINITO";
                document.getElementById('display-keys').innerText = db.keys.length;
            }
        }

        function executeGeneration() {
            const days = parseInt(document.getElementById('k-time').value);
            const cost = { 1: 5, 7: 15, 30: 40 }[days];
            const pre = document.getElementById('k-prefix').value.toUpperCase() || "KEY";
            let db = getDB();

            if(session.role !== 'ADM') {
                let user = db.users.find(u => u.id === session.id);
                if(user.credits < cost) return alert("Saldo insuficiente!");
                user.credits -= cost;
            }

            const newKey = {
                code: `${pre}-${days}D-${Math.random().toString(36).substring(2,8).toUpperCase()}`,
                expiry: Date.now() + (days * 24 * 60 * 60 * 1000),
                ownerId: session.id,
                ownerName: session.name
            };

            db.keys.push(newKey);
            saveDB(db);
            document.getElementById('k-final').innerText = newKey.code;
            document.getElementById('k-res-box').style.display = "block";
            updateDashboard();
            updateAllClocks();
            alert("Key Gerada!");
        }

        function toggleFreeze() {
            let db = getDB();
            const now = Date.now();
            if(!db.frozen) { db.frozen = true; db.freezeTime = now; }
            else { 
                const dur = now - db.freezeTime;
                db.keys = db.keys.map(k => ({ ...k, expiry: k.expiry + dur }));
                db.frozen = false; db.freezeTime = null;
            }
            saveDB(db);
            updateAllClocks();
        }

        function updateAllClocks() {
            const db = getDB();
            const tbody = document.getElementById('table-keys');
            if(!tbody) return;
            tbody.innerHTML = "";
            const now = Date.now();
            const list = session.role === 'ADM' ? db.keys : db.keys.filter(k => k.ownerId === session.id);

            list.slice().reverse().forEach(k => {
                let diff = k.expiry - (db.frozen ? db.freezeTime : now);
                let status = "ATIVA", pill = "active-pill";

                if(diff <= 0) { status = "EXPIRADA"; pill = "expired-pill"; diff = 0; }
                else if(db.frozen) { status = "PAUSADA"; pill = "paused-pill"; }

                const d = Math.floor(diff/(1000*60*60*24));
                const h = Math.floor((diff/(1000*60*60))%24);
                const m = Math.floor((diff/(1000*60))%60);

                tbody.innerHTML += `<tr>
                    <td>${k.code}</td>
                    <td><span class="status-pill ${pill}">${status}</span></td>
                    <td>${status === "EXPIRADA" ? "---" : d+"d "+h+"h "+m+"m"}</td>
                    <td>${k.ownerName}</td>
                </tr>`;
            });

            if(session.role === 'ADM') {
                const btn = document.getElementById('adm-freeze-btn');
                btn.innerText = db.frozen ? "RETOMAR" : "CONGELAR";
            }
        }

        function refreshAdmLists() {
            const db = getDB();
            const tbody = document.getElementById('table-users');
            const select = document.getElementById('adm-user-select');
            tbody.innerHTML = ""; select.innerHTML = "";
            db.users.forEach(u => {
                tbody.innerHTML += `<tr><td>${u.name}</td><td>R$ ${u.credits.toFixed(2)}</td><td><button onclick="deleteUser(${u.id})" style="background:none; border:none; color:var(--danger); cursor:pointer;"><i data-lucide="trash-2" size="16"></i></button></td></tr>`;
                select.innerHTML += `<option value="${u.id}">${u.name}</option>`;
            });
            lucide.createIcons();
        }

        function injectCredits() {
            const id = document.getElementById('adm-user-select').value;
            const val = parseFloat(document.getElementById('adm-amount').value);
            if(!id || isNaN(val)) return;
            let db = getDB();
            db.users = db.users.map(u => u.id == id ? { ...u, credits: u.credits + val } : u);
            saveDB(db);
            refreshAdmLists();
            alert("Sucesso!");
        }

        function deleteUser(id) {
            if(!confirm("Remover usuário permanentemente?")) return;
            let db = getDB();
            db.users = db.users.filter(u => u.id !== id);
            saveDB(db);
            refreshAdmLists();
        }

        function toggleDrawer() { 
            const drawer = document.getElementById('menu-drawer');
            const icon = document.getElementById('fab-icon');
            drawer.classList.toggle('open');
            icon.setAttribute('data-lucide', drawer.classList.contains('open') ? 'x' : 'menu');
            lucide.createIcons();
        }

        function nav(viewId, element) {
            document.querySelectorAll('.view').forEach(e => e.classList.remove('active'));
            document.getElementById('v-' + viewId).classList.add('active');
            
            document.querySelectorAll('.nav-link').forEach(e => e.classList.remove('active-link'));
            if (element) {
                 element.classList.add('active-link');
            }
            toggleDrawer(); // Fecha o menu sanduíche após a navegação
        }

        window.onload = () => lucide.createIcons();
    </script>
</body>
                        </html>
                                                                                                                      
