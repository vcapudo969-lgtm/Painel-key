<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Key Generator PRO</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-950 text-white flex items-center justify-center min-h-screen">

<div class="bg-gray-900 p-8 rounded-xl w-full max-w-md">
  <h1 class="text-2xl font-bold text-center mb-6">Key Generator PRO</h1>

  <!-- LOGIN -->
  <div id="loginBox">
    <input id="loginUser" placeholder="Usu치rio" class="w-full p-2 mb-3 bg-gray-800 rounded">
    <input id="loginPass" type="password" placeholder="Senha" class="w-full p-2 mb-4 bg-gray-800 rounded">

    <button onclick="login()" class="w-full bg-blue-600 p-2 rounded">Entrar</button>

    <p class="text-center text-sm mt-3">
      N칚o tem conta?
      <button onclick="toggle()" class="text-blue-400">Registrar</button>
    </p>
  </div>

  <!-- REGISTRO -->
  <div id="registerBox" class="hidden">
    <input id="regUser" placeholder="Novo usu치rio" class="w-full p-2 mb-3 bg-gray-800 rounded">
    <input id="regPass" type="password" placeholder="Senha" class="w-full p-2 mb-4 bg-gray-800 rounded">

    <button onclick="register()" class="w-full bg-green-600 p-2 rounded">Registrar</button>

    <p class="text-center text-sm mt-3">
      J치 tem conta?
      <button onclick="toggle()" class="text-blue-400">Login</button>
    </p>
  </div>

  <p id="msg" class="text-red-500 mt-3 text-center"></p>
</div>

<script>
// 游 INICIALIZA칂츾O SEGURA DO SISTEMA
let users = JSON.parse(localStorage.getItem('users'))

if (!users) {
  users = {
    admin: {
      pass: 'admin123',
      role: 'admin',
      credits: Infinity
    }
  }
  localStorage.setItem('users', JSON.stringify(users))
}

// alternar telas
function toggle() {
  loginBox.classList.toggle('hidden')
  registerBox.classList.toggle('hidden')
  msg.innerText = ''
}

// REGISTRO (NUNCA ADM)
function register() {
  const u = regUser.value.trim()
  const p = regPass.value.trim()

  if (!u || !p) {
    msg.innerText = 'Preencha todos os campos'
    return
  }

  if (u.toLowerCase() === 'admin') {
    msg.innerText = 'Nome reservado'
    return
  }

  if (users[u]) {
    msg.innerText = 'Usu치rio j치 existe'
    return
  }

  users[u] = {
    pass: p,
    role: 'member',
    credits: 5
  }

  localStorage.setItem('users', JSON.stringify(users))
  msg.innerText = 'Conta criada com sucesso'
  toggle()
}

// LOGIN (ADM OU MEMBRO)
function login() {
  const u = loginUser.value.trim()
  const p = loginPass.value.trim()

  if (!users[u] || users[u].pass !== p) {
    msg.innerText = 'Login inv치lido'
    return
  }

  sessionStorage.setItem('user', u)
  sessionStorage.setItem('role', users[u].role)

  if (users[u].role === 'admin') {
    sessionStorage.setItem('adm_token', 'ADM-' + crypto.randomUUID())
    location.href = 'admin.html'
  } else {
    location.href = 'user.html'
  }
}
</script>

</body>
</html>
