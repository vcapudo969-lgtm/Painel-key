<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Key System - Pro</title>
    <link rel="stylesheet" href="cdnjs.cloudflare.com">
    <style>
        :root {
            --bg: #0a0a0b;
            --card: #151517;
            --primary: #8a2be2;
            --accent: #00f2ff;
            --text: #e0e0e0;
            --danger: #ff2d55;
            --success: #00ff88;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', 'Segoe UI', sans-serif; }
        body { background-color: var(--bg); color: var(--text); overflow-x: hidden; }

        /* Login Screen */
        #auth-screen {
            height: 100vh; display: flex; align-items: center; justify-content: center;
            background: radial-gradient(circle at top right, #1a0b2e 0%, #0a0a0b 100%);
        }
        .auth-card {
            background: var(--card); padding: 2.5rem; border-radius: 20px;
            width: 100%; max-width: 400px; border: 1px solid #2d2d2d; box-shadow: 0 20px 50px rgba(0,0,0,0.7);
        }
        input, select { 
            width: 100%; padding: 14px; background: #1e1e20; border: 1px solid #333; 
            color: #fff; border-radius: 8px; margin-top: 8px; transition: 0.3s;
        }
        input:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 10px rgba(138, 43, 226, 0.3); }

        button {
            width: 100%; padding: 14px; border: none; border-radius: 8px;
            background: var(--primary); color: white; cursor: pointer; font-weight: 600;
            margin-top: 20px; transition: 0.3s;
        }
        button:hover { transform: translateY(-2px); filter: brightness(1.2); }
        .btn-danger { background: var(--danger); padding: 6px 12px; font-size: 12px; }

        /* App Layout */
        #app-screen { display: none; padding: 30px; max-width: 1200px; margin: auto; }
        .view-section { display: none; animation: slideUp 0.4s ease-out; }
        .view-active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* Modern Table */
        .table-container { background: var(--card); border-radius: 15px; overflow: hidden; border: 1px solid #2d2d2d; margin-top: 20px; }
        .list-table { width: 100%; border-collapse: collapse; }
        .list-table th { background: #1c1c1f; padding: 18px; text-align: left; font-size: 14px; color: #888; }
        .list-table td { padding: 18px; border-bottom: 1px solid #252527; }
        .badge { padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: bold; text-transform: uppercase; }
        .badge-admin { background: rgba(0, 242, 255, 0.1); color: var(--accent); border: 1px solid var(--accent); }
        .badge-user { background: rgba(138, 43, 226, 0.1); color: var(--primary); border: 1px solid var(--primary); }

        /* Menu Sanduíche */
        .menu-container { position: fixed; bottom: 30px; right: 30px; z-index: 9999; }
        .fab {
            width: 65px; height: 65px; border-radius: 50%; background: var(--primary);
            display: flex; align-items: center; justify-content: center; font-size: 24px;
            cursor: pointer; box-shadow: 0 10px 30px rgba(138, 43, 226, 0.4); transition: 0.5s;
        }
        .fab.active { transform: rotate(135deg); background: var(--danger); }
        .menu-items {
            position: absolute; bottom: 80px; right: 0; display: none;
            flex-direction: column; gap: 12px; min-width: 220px;
        }
        .menu-item {
            background: var(--card); padding: 15px 20px; border-radius: 12px;
            border: 1px solid #333; cursor: pointer; display: flex; align-items: center; gap: 15px;
            transition: 0.3s; box-shadow: 0 10px 20px rgba(0,0,0,0.4);
        }
        .menu-item:hover { border-color: var(--primary); background: #1c1c1f; padding-left: 25px; }
        .admin-only { border-left: 3px solid var(--accent); }

        /* Dashboard Stats */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 40px; }
        .stat-card { background: var(--card); padding: 25px; border-radius: 15px; border: 1px solid #2d2d2d; position: relative; overflow: hidden; }
        .stat-card h3 { color: #888; font-size: 14px; margin-bottom: 10px; }
        .stat-card .val { font-size: 32px; font-weight: bold; color: #fff; }
    </style>
</head>
<body>

    <div id="auth-screen">
        <div class="auth-card">
            <h2 id="auth-title" style="margin-bottom: 1.5rem; text-align: center;">Bem-vindo</h2>
            <input type="text" id="auth-user" placeholder="Usuário">
            <input type="password" id="auth-pass" placeholder="Senha">
            <button onclick="handleAuth()" id="btn-auth">Acessar Painel</button>
            <p onclick="toggleAuthMode()" id="toggle-text" style="text-align: center; margin-top: 20px; font-size: 13px; color: #666; cursor: pointer;">
                Criar nova conta de usuário
            </p>
        </div>
    </div>

    <div id="app-screen">
        <header style="margin-bottom: 40px; display: flex; justify-content: space-between; align-items: center;">
            <div>
                <h1 id="view-title">Dashboard</h1>
                <p id="welcome-msg" style="color: #666; font-size: 14px;"></p>
            </div>
            <button onclick="location.reload()" style="width: auto; margin:0; padding: 10px 20px; background: #222;">Sair</button>
        </header>

        <!-- DASHBOARD -->
        <div id="section-dashboard" class="view-section view-active">
            <div class="stats-grid">
                <div class="stat-card"><h3>Usuários Registrados</h3><div class="val" id="stat-users">0</div></div>
                <div class="stat-card"><h3>Keys Geradas</h3><div class="val" id="stat-keys">0</div></div>
                <div class="stat-card"><h3>Créditos em Circulação</h3><div class="val" id="stat-credits">0</div></div>
            </div>
            <h3 style="margin-bottom:15px">Histórico de Keys</h3>
            <div class="table-container">
                <table class="list-table"><tbody id="body-keys"></tbody></table>
            </div>
        </div>

        <!-- GERENCIAR USUÁRIOS (SOMENTE ADM) -->
        <div id="section-users" class="view-section">
            <h3 style="color: var(--accent)">Gestão de Membros</h3>
            <p style="color: #666; font-size: 14px; margin-bottom: 20px;">Remova usuários ou altere permissões do banco de dados.</p>
            <div class="table-container">
                <table class="list-table">
                    <thead><tr><th>Usuário</th><th>Cargo</th><th>Créditos</th><th>Ações</th></tr></thead>
                    <tbody id="body-users"></tbody>
                </table>
            </div>
        </div>

        <!-- CRÉDITOS (SOMENTE ADM) -->
        <div id="section-credits" class="view-section">
            <div class="auth-card" style="max-width: 500px; margin: auto;">
                <h3>Recarregar Saldo</h3><br>
                <label>Selecionar Usuário</label>
                <select id="select-user-credit"></select>
                <input type="number" id="credit-amount" placeholder="Valor em R$ ou Qtd">
                <button onclick="addCredits()">Confirmar Depósito</button>
            </div>
        </div>

        <!-- GERAR KEYS -->
        <div id="section-gen-keys" class="view-section">
            <div class="auth-card" style="max-width: 500px; margin: auto;">
                <h3>Gerador Temporário</h3><br>
                <select id="key-time">
                    <option value="1">24 Horas</option>
                    <option value="7">7 Dias</option>
                    <option value="30">30 Dias</option>
                </select>
                <button onclick="generateKey()" style="background: var(--accent); color: #000;">Gerar Nova Key</button>
                <div id="last-key" style="margin-top: 25px; padding: 15px; background: #000; border: 1px dashed var(--accent); border-radius: 8px; display: none; text-align: center; font-family: monospace; color: var(--accent);"></div>
            </div>
        </div>

        <div class="menu-container">
            <div class="menu-items" id="menu-box">
                <div class="menu-item" onclick="showSection('dashboard')"><i class="fas fa-chart-pie"></i> Dashboard</div>
                <div class="menu-item admin-only" id="menu-users" onclick="showSection('users')"><i class="fas fa-user-shield"></i> Gerenciar Usuários</div>
                <div class="menu-item admin-only" id="menu-credits" onclick="showSection('credits')"><i class="fas fa-coins"></i> Adicionar Créditos</div>
                <div class="menu-item" onclick="showSection('gen-keys')"><i class="fas fa-bolt"></i> Gerar Keys</div>
            </div>
            <div class="fab" onclick="toggleMenu()"><i class="fas fa-plus"></i></div>
        </div>
    </div>

    <script>
        // DB Inicial
        let db = JSON.parse(localStorage.getItem('sys_pro_2025')) || {
            users: [{user: 'admin', pass: 'admin', credits: 1000, role: 'ADM'}],
            keys: []
        };

        let isLoginMode = true;
        let currentUser = null;

        function saveData() { localStorage.setItem('sys_pro_2025', JSON.stringify(db)); }

        function toggleAuthMode() {
            isLoginMode = !isLoginMode;
            document.getElementById('auth-title').innerText = isLoginMode ? "Bem-vindo" : "Nova Conta";
            document.getElementById('btn-auth').innerText = isLoginMode ? "Acessar Painel" : "Registrar Usuário";
            document.getElementById('toggle-text').innerText = isLoginMode ? "Criar nova conta de usuário" : "Já possuo acesso";
        }

        function handleAuth() {
            const u = document.getElementById('auth-user').value.toLowerCase();
            const p = document.getElementById('auth-pass').value;

            if(isLoginMode) {
                const found = db.users.find(x => x.user === u && x.pass === p);
                if(found) {
                    currentUser = found;
                    loginSuccess();
                } else alert("Usuário ou senha inválidos.");
            } else {
                if(db.users.find(x => x.user === u)) return alert("Nome de usuário indisponível.");
                db.users.push({user: u, pass: p, credits: 0, role: 'USER'});
                saveData();
                alert("Conta criada com sucesso!");
                toggleAuthMode();
            }
        }

        function loginSuccess() {
            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('app-screen').style.display = 'block';
            document.getElementById('welcome-msg').innerText = `Logado como: ${currentUser.user.toUpperCase()} (${currentUser.role})`;
            
            // Restrição visual de Admin
            if(currentUser.role !== 'ADM') {
                document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'none');
            }
            
            updateDashboard();
            showSection('dashboard');
        }

        function showSection(id) {
            if((id === 'users' || id === 'credits') && currentUser.role !== 'ADM') {
                alert("Acesso restrito a administradores!");
                return;
            }
            document.querySelectorAll('.view-section').forEach(s => s.classList.remove('view-active'));
            document.getElementById('section-' + id).classList.add('view-active');
            document.getElementById('view-title').innerText = id.charAt(0).toUpperCase() + id.slice(1);
            if(id === 'users') renderUserManagement();
            if(id === 'credits') populateCreditsSelect();
            if(id === 'dashboard') updateDashboard();
            if(document.getElementById('menu-box').style.display === 'flex') toggleMenu();
        }

        function renderUserManagement() {
            const tbody = document.getElementById('body-users');
            tbody.innerHTML = "";
            db.users.forEach((u, index) => {
                const isSelf = u.user === currentUser.user;
                tbody.innerHTML += `
                    <tr>
                        <td><strong>${u.user}</strong></td>
                        <td><span class="badge ${u.role === 'ADM' ? 'badge-admin' : 'badge-user'}">${u.role}</span></td>
                        <td>$ ${u.credits}</td>
                        <td>
                            ${isSelf ? '<em>(Você)</em>' : `<button class="btn-danger" onclick="deleteUser(${index})">Excluir</button>`}
                        </td>
                    </tr>`;
            });
        }

        function deleteUser(index) {
            if(confirm("Tem certeza que deseja remover este usuário?")) {
                db.users.splice(index, 1);
                saveData();
                renderUserManagement();
            }
        }

        function populateCreditsSelect() {
            const select = document.getElementById('select-user-credit');
            select.innerHTML = db.users.map(u => `<option value="${u.user}">${u.user}</option>`).join('');
        }

        function addCredits() {
            const target = document.getElementById('select-user-credit').value;
            const amount = parseInt(document.getElementById('credit-amount').value);
            const user = db.users.find(x => x.user === target);
            if(user && amount > 0) {
                user.credits += amount;
                saveData();
                alert(`Créditos injetados com sucesso para ${target}!`);
                document.getElementById('credit-amount').value = "";
            }
        }

        function generateKey() {
            const time = document.getElementById('key-time').value;
            const code = "KEY-" + Math.random().toString(36).substr(2, 9).toUpperCase();
            db.keys.push({code: code, days: time, creator: currentUser.user, date: new Date().toLocaleDateString()});
            saveData();
            const res = document.getElementById('last-key');
            res.style.display = 'block';
            res.innerText = code;
        }

        function updateDashboard() {
            document.getElementById('stat-users').innerText = db.users.length;
            document.getElementById('stat-keys').innerText = db.keys.length;
            document.getElementById('stat-credits').innerText = db.users.reduce((a, b) => a + (b.credits || 0), 0);
            
            const tbody = document.getElementById('body-keys');
            tbody.innerHTML = db.keys.slice(-5).reverse().map(k => `
                <tr>
                    <td style="color:var(--accent)">${k.code}</td>
                    <td>${k.days} Dias</td>
                    <td style="text-align:right; font-size:12px; color:#555">${k.date}</td>
                </tr>
            `).join('');
        }

        function toggleMenu() {
            const menu = document.getElementById('menu-box');
            const fab = document.querySelector('.fab');
            menu.style.display = menu.style.display === 'flex' ? 'none' : 'flex';
            fab.classList.toggle('active');
        }
    </script>
</body>
</html>
