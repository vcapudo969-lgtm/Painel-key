<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Painel ADM</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-950 text-white">

<script>
if (
  sessionStorage.getItem('role') !== 'admin' ||
  !sessionStorage.getItem('adm_token') ||
  !sessionStorage.getItem('adm_token').startsWith('ADM-')
) {
  location.href = 'index.html'
}
</script>

<nav class="bg-gray-900 p-4 flex justify-between">
  <strong>Painel ADM</strong>
  <button onclick="logout()" class="text-red-500">Sair</button>
</nav>

<div class="p-6 grid md:grid-cols-3 gap-6">

<div class="bg-gray-900 p-4 rounded-xl">
  <h2 class="font-bold mb-2">Gerar Key</h2>
  <button onclick="generateKey()" class="bg-green-600 p-2 rounded w-full">Gerar</button>
  <p id="keyOut" class="mt-3 break-all"></p>
</div>

<div class="bg-gray-900 p-4 rounded-xl">
  <h2 class="font-bold mb-2">Usu√°rios</h2>
  <ul id="usersList"></ul>
</div>

<div class="bg-gray-900 p-4 rounded-xl">
  <h2 class="font-bold mb-2">Logs</h2>
  <ul id="logs" class="text-xs max-h-40 overflow-y-auto"></ul>
</div>

</div>

<script>
const users = JSON.parse(localStorage.getItem('users')) || {}
let keys = JSON.parse(localStorage.getItem('keys')) || []
let logs = JSON.parse(localStorage.getItem('logs')) || []

function generateKey() {
  const key = 'KEY-' + crypto.randomUUID().slice(0,10).toUpperCase()
  keys.push({ key, used:false })
  keyOut.innerText = key
  addLog('Gerou uma key')
  save()
}

function addLog(text) {
  logs.push(`[${new Date().toLocaleTimeString()}] ${text}`)
}

function save() {
  localStorage.setItem('keys', JSON.stringify(keys))
  localStorage.setItem('logs', JSON.stringify(logs))
}

function load() {
  usersList.innerHTML = ''
  Object.keys(users).forEach(u => {
    usersList.innerHTML += `<li>${u} (${users[u].role})</li>`
  })

  logs.forEach(l => {
    document.getElementById('logs').innerHTML += `<li>${l}</li>`
  })
}

function logout() {
  sessionStorage.clear()
  location.href = 'index.html'
}

load()
</script>
</body>
</html>
